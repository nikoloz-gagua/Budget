<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Budget Planner</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600&family=DM+Mono:wght@300;400;500&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0a0f;
    --surface: #111118;
    --surface2: #18181f;
    --border: #1e1e2e;
    --accent: #00e5a0;
    --accent2: #7c6af7;
    --danger: #ff5566;
    --warn: #f5a623;
    --text: #e8e8f0;
    --muted: #5a5a7a;
    --muted2: #3a3a5a;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    font-size: 13px;
  }

/* LAYOUT */
.shell { display: flex; min-height: 100vh; }

/* SIDEBAR */
aside {
width: 220px;
background: var(--surface);
border-right: 1px solid var(--border);
display: flex;
flex-direction: column;
padding: 0;
position: fixed;
top:0; left:0; bottom:0;
z-index: 10;
}
.logo {
padding: 28px 24px 20px;
border-bottom: 1px solid var(--border);
}
.logo-title {
font-family: 'Cormorant Garamond', serif;
font-size: 22px;
font-weight: 300;
letter-spacing: 0.05em;
color: var(--accent);
}
.logo-sub { font-size: 10px; color: var(--muted); letter-spacing: 0.15em; text-transform: uppercase; margin-top: 2px; }
nav { padding: 16px 0; flex: 1; }
.nav-section { padding: 8px 24px 4px; font-size: 9px; color: var(--muted); letter-spacing: 0.2em; text-transform: uppercase; }
.nav-item {
display: flex; align-items: center; gap: 10px;
padding: 10px 24px;
cursor: pointer;
color: var(--muted);
transition: all 0.15s;
border-left: 2px solid transparent;
font-size: 12px;
}
.nav-item:hover { color: var(--text); background: var(--surface2); }
.nav-item.active { color: var(--accent); border-left-color: var(--accent); background: rgba(0,229,160,0.05); }
.nav-item svg { width:15px; height:15px; flex-shrink:0; }

.month-nav {
padding: 16px 24px;
border-top: 1px solid var(--border);
}
.month-label { font-size: 10px; color: var(--muted); letter-spacing: 0.15em; text-transform: uppercase; margin-bottom: 8px; }
.month-display {
display: flex; align-items: center; justify-content: space-between;
font-family: 'Cormorant Garamond', serif;
font-size: 16px;
color: var(--text);
}
.month-btn { background: none; border: none; color: var(--muted); cursor: pointer; font-size: 16px; padding: 2px 4px; }
.month-btn:hover { color: var(--accent); }

.sidebar-toggle {
position:absolute; top:14px; right:12px;
border:1px solid var(--border); background:var(--surface2); color:var(--muted);
width:28px; height:28px; border-radius:6px; cursor:pointer;
font-size:14px; line-height:1;
}
.sidebar-toggle:hover { color: var(--accent); border-color: var(--accent); }

body.sidebar-collapsed aside { width: 70px; }
body.sidebar-collapsed .logo-title,
body.sidebar-collapsed .logo-sub,
body.sidebar-collapsed .nav-section,
body.sidebar-collapsed .nav-item span,
body.sidebar-collapsed .month-nav { display:none; }
body.sidebar-collapsed .nav-item { justify-content:center; padding: 12px 10px; border-left:none; }
body.sidebar-collapsed .nav-item.active { border-left:none; box-shadow: inset 2px 0 0 var(--accent); }
body.sidebar-collapsed .sidebar-toggle { right: 50%; transform: translateX(50%); }
body.sidebar-collapsed main { margin-left: 70px; }

/* MAIN */
main { margin-left: 220px; flex: 1; padding: 32px; min-height: 100vh; }

/* PAGES */
.page { display: none; animation: fadeIn 0.2s ease; }
.page.active { display: block; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(6px); } to { opacity: 1; transform: none; } }

/* HEADER */
.page-header { margin-bottom: 28px; }
.page-title {
font-family: 'Cormorant Garamond', serif;
font-size: 36px; font-weight: 300;
color: var(--text);
line-height: 1;
}
.page-sub { color: var(--muted); font-size: 11px; margin-top: 4px; letter-spacing: 0.05em; }

/* CARDS */
.cards-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap: 16px; margin-bottom: 24px; }
.card {
background: var(--surface);
border: 1px solid var(--border);
border-radius: 8px;
padding: 20px;
position: relative;
overflow: hidden;
}
.card::before {
content: '';
position: absolute;
top: 0; left: 0; right: 0;
height: 2px;
}
.card.green::before { background: var(--accent); }
.card.red::before { background: var(--danger); }
.card.purple::before { background: var(--accent2); }
.card.warn::before { background: var(--warn); }
.card-label { font-size: 10px; color: var(--muted); letter-spacing: 0.15em; text-transform: uppercase; }
.card-value {
font-family: 'Cormorant Garamond', serif;
font-size: 30px; font-weight: 400;
color: var(--text);
margin-top: 6px;
line-height: 1;
}
.card.green .card-value { color: var(--accent); }
.card.red .card-value { color: var(--danger); }
.card-sub { font-size: 10px; color: var(--muted); margin-top: 6px; }

/* GRID */
.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 24px; }
.grid-wide { display: grid; grid-template-columns: 2fr 1fr; gap: 16px; margin-bottom: 24px; }

/* SECTION */
.section {
background: var(--surface);
border: 1px solid var(--border);
border-radius: 8px;
padding: 20px;
}
.section-header {
display: flex; align-items: center; justify-content: space-between;
margin-bottom: 16px;
}
.section-title { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 400; }
.section-meta { font-size: 10px; color: var(--muted); }

/* BAR CHART */
.bar-chart { display: flex; align-items: flex-end; gap: 6px; height: 120px; margin-bottom: 8px; }
.bar-wrap { flex: 1; display: flex; flex-direction: column; align-items: center; gap: 4px; height: 100%; justify-content: flex-end; }
.bar {
width: 100%; border-radius: 3px 3px 0 0;
transition: height 0.4s cubic-bezier(.4,0,.2,1);
min-height: 2px;
position: relative;
}
.bar.income { background: var(--accent); opacity: 0.8; }
.bar.expense { background: var(--danger); opacity: 0.8; }
.bar-label { font-size: 9px; color: var(--muted); }
.bar-legend { display: flex; gap: 16px; margin-top: 8px; }
.bar-legend-item { display: flex; align-items: center; gap: 5px; font-size: 10px; color: var(--muted); }
.dot { width: 6px; height: 6px; border-radius: 50%; }

/* DONUT */
.donut-wrap { position: relative; width: 120px; height: 120px; flex-shrink: 0; }
.donut-wrap svg { transform: rotate(-90deg); }
.donut-center {
position: absolute; inset: 0;
display: flex; flex-direction: column; align-items: center; justify-content: center;
font-family: 'Cormorant Garamond', serif;
}
.donut-pct { font-size: 22px; font-weight: 400; color: var(--accent); }
.donut-sub { font-size: 9px; color: var(--muted); }

/* BUDGET BARS */
.budget-item { margin-bottom: 14px; }
.budget-item:last-child { margin-bottom: 0; }
.budget-row { display: flex; justify-content: space-between; margin-bottom: 5px; }
.budget-cat { font-size: 11px; color: var(--text); }
.budget-amounts { font-size: 10px; color: var(--muted); }
.budget-bar-track { height: 4px; background: var(--border); border-radius: 2px; overflow: hidden; }
.budget-bar-fill { height: 100%; border-radius: 2px; transition: width 0.5s cubic-bezier(.4,0,.2,1); }

/* TRANSACTIONS */
.tx-filters { display: flex; gap: 8px; margin-bottom: 16px; }
.filter-btn {
padding: 5px 12px; border-radius: 20px;
border: 1px solid var(--border);
background: none; color: var(--muted);
cursor: pointer; font-family: 'DM Mono', monospace; font-size: 11px;
transition: all 0.15s;
}
.filter-btn.active { background: var(--accent); border-color: var(--accent); color: var(--bg); }
.filter-btn:hover:not(.active) { border-color: var(--muted); color: var(--text); }

.tx-list { display: flex; flex-direction: column; gap: 2px; }
.tx-item {
display: grid; grid-template-columns: 36px 1fr auto;
align-items: center; gap: 12px;
padding: 10px 12px;
border-radius: 6px;
transition: background 0.12s;
cursor: default;
}
.tx-item:hover { background: var(--surface2); }
.tx-icon {
width: 32px; height: 32px; border-radius: 8px;
display: flex; align-items: center; justify-content: center;
font-size: 14px; flex-shrink: 0;
}
.tx-info { min-width: 0; }
.tx-name { font-size: 12px; color: var(--text); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
.tx-meta { font-size: 10px; color: var(--muted); margin-top: 1px; }
.tx-amount { font-family: 'Cormorant Garamond', serif; font-size: 18px; font-weight: 500; text-align: right; }
.tx-amount.income { color: var(--accent); }
.tx-amount.expense { color: var(--danger); }

.tx-actions { display: flex; gap: 4px; margin-left: 8px; }
.tx-del { background: none; border: none; color: var(--muted2); cursor: pointer; font-size: 14px; padding: 2px 4px; border-radius: 4px; }
.tx-del:hover { color: var(--danger); background: rgba(255,85,102,0.1); }

/* FORM */
.form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.form-group { display: flex; flex-direction: column; gap: 5px; }
.form-group.full { grid-column: 1 / -1; }
label { font-size: 10px; color: var(--muted); letter-spacing: 0.12em; text-transform: uppercase; }
input, select, textarea {
background: var(--bg);
border: 1px solid var(--border);
border-radius: 6px;
color: var(--text);
padding: 9px 12px;
font-family: 'DM Mono', monospace;
font-size: 12px;
outline: none;
transition: border-color 0.15s;
width: 100%;
}
input:focus, select:focus, textarea:focus { border-color: var(--accent); }
select option { background: var(--surface); }
textarea { resize: vertical; min-height: 60px; }

.type-toggle { display: flex; gap: 0; border: 1px solid var(--border); border-radius: 6px; overflow: hidden; }
.type-btn {
flex: 1; padding: 9px; border: none; background: none;
color: var(--muted); cursor: pointer; font-family: 'DM Mono', monospace; font-size: 12px;
transition: all 0.15s;
}
.type-btn.active.income { background: rgba(0,229,160,0.15); color: var(--accent); }
.type-btn.active.expense { background: rgba(255,85,102,0.15); color: var(--danger); }

.btn {
padding: 10px 20px; border-radius: 6px; border: none;
cursor: pointer; font-family: 'DM Mono', monospace; font-size: 12px;
transition: all 0.15s; font-weight: 500;
}
.btn-primary { background: var(--accent); color: var(--bg); }
.btn-primary:hover { background: #00c98a; }
.btn-ghost { background: var(--surface2); color: var(--text); border: 1px solid var(--border); }
.btn-ghost:hover { border-color: var(--accent); color: var(--accent); }

/* BUDGETS PAGE */
.budget-card {
background: var(--surface);
border: 1px solid var(--border);
border-radius: 8px;
padding: 18px;
margin-bottom: 12px;
}
.budget-header-row { display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; }
.budget-cat-name { font-family: 'Cormorant Garamond', serif; font-size: 20px; }
.budget-pct-badge {
font-size: 10px; padding: 3px 8px; border-radius: 12px;
font-weight: 500;
}
.budget-pct-badge.ok { background: rgba(0,229,160,0.15); color: var(--accent); }
.budget-pct-badge.warn { background: rgba(245,166,35,0.15); color: var(--warn); }
.budget-pct-badge.over { background: rgba(255,85,102,0.15); color: var(--danger); }

/* SETTINGS */
.settings-section { margin-bottom: 28px; }
.settings-title { font-family: 'Cormorant Garamond', serif; font-size: 20px; margin-bottom: 14px; }

/* EMPTY */
.empty { text-align: center; padding: 40px 20px; color: var(--muted); }
.empty-icon { font-size: 36px; margin-bottom: 12px; opacity: 0.4; }
.empty-text { font-size: 12px; }

/* MODAL */
.modal-overlay {
position: fixed; inset: 0;
background: rgba(0,0,0,0.7);
backdrop-filter: blur(4px);
display: flex; align-items: center; justify-content: center;
z-index: 100;
opacity: 0; pointer-events: none;
transition: opacity 0.2s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
background: var(--surface);
border: 1px solid var(--border);
border-radius: 12px;
padding: 28px;
width: 480px;
max-width: 95vw;
transform: translateY(20px);
transition: transform 0.2s;
}
.modal-overlay.open .modal { transform: none; }
.modal-title { font-family: 'Cormorant Garamond', serif; font-size: 24px; margin-bottom: 20px; }
.modal-footer { display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px; }

/* SCROLL */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--muted2); border-radius: 2px; }

/* RECENT TX HEADER */
.add-btn {
padding: 6px 14px; background: var(--accent); color: var(--bg);
border: none; border-radius: 5px; cursor: pointer;
font-family: 'DM Mono', monospace; font-size: 11px; font-weight: 500;
}
.add-btn:hover { background: #00c98a; }

/* SAVINGS GOAL */
.goal-bar-track { height: 8px; background: var(--border); border-radius: 4px; overflow: hidden; margin: 8px 0; }
.goal-bar-fill { height: 100%; background: linear-gradient(90deg, var(--accent2), var(--accent)); border-radius: 4px; transition: width 0.5s; }

/* CURRENCY */
.currency { font-size: 13px; color: var(--muted); margin-right: 1px; }

/* MONTHLY PLANNER */
.planner-grid { display:grid; grid-template-columns: repeat(4, minmax(120px, 1fr)); gap:12px; margin-bottom:14px; }
.kpi-row { display:grid; grid-template-columns: repeat(auto-fit, minmax(170px, 1fr)); gap:10px; }
.kpi-chip { background: var(--surface2); border:1px solid var(--border); border-radius:8px; padding:10px; }
.kpi-label { font-size:10px; color:var(--muted); text-transform:uppercase; letter-spacing:0.12em; }
.kpi-value { font-size:18px; font-family:'Cormorant Garamond', serif; margin-top:4px; }
.kpi-value.good { color:var(--accent); }
.kpi-value.warn { color:var(--warn); }
.kpi-value.bad { color:var(--danger); }
.insight-list { display:flex; flex-direction:column; gap:8px; }
.insight-item { border:1px solid var(--border); background:var(--surface2); border-radius:8px; padding:10px 12px; font-size:11px; }
.insight-item.warn { border-color: rgba(245,166,35,0.4); }
.insight-item.bad { border-color: rgba(255,85,102,0.5); }

@media(max-width: 768px) {
aside {
  width: 100%; height: 62px; top: auto; bottom: 0; border-right: none;
  border-top: 1px solid var(--border); background: rgba(17,17,24,0.98);
}
.logo, .nav-section, .month-nav, .nav-item span { display:none; }
nav { display:flex; align-items:center; justify-content:space-around; padding: 0 8px; }
.nav-item { border-left:none; border-top:2px solid transparent; padding: 10px 8px; }
.nav-item.active { border-left:none; border-top-color: var(--accent); }
.nav-item svg { width:18px; height:18px; }
main { margin-left: 0; padding: 14px; margin-bottom: 74px; }
.page-title { font-size: 30px; }
.cards-row, .grid2, .grid-wide, .form-grid, .planner-grid { grid-template-columns: 1fr; }
.modal { padding: 20px; }
.sidebar-toggle { display:none; }
}
</style>

</head>
<body>

<div class="shell">
<!-- SIDEBAR -->
<aside>
  <div class="logo">
    <button class="sidebar-toggle" onclick="toggleSidebar()" title="Collapse sidebar">â€¹</button>
    <div class="logo-title">vault.</div>
    <div class="logo-sub">Personal Finance</div>
  </div>
  <nav>
    <div class="nav-section">Overview</div>
    <div class="nav-item active" onclick="goto('dashboard', this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z"/></svg>
      <span>Dashboard</span>
    </div>
    <div class="nav-item" onclick="goto('transactions', this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M7.5 21L3 16.5m0 0L7.5 12M3 16.5h13.5m0-13.5L21 7.5m0 0L16.5 12M21 7.5H7.5"/></svg>
      <span>Transactions</span>
    </div>
    <div class="nav-section">Planning</div>
    <div class="nav-item" onclick="goto('budgets', this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 3v11.25A2.25 2.25 0 006 16.5h2.25M3.75 3h-1.5m1.5 0h16.5m0 0h1.5m-1.5 0v11.25A2.25 2.25 0 0118 16.5h-2.25m-7.5 0h7.5m-7.5 0l-1 3m8.5-3l1 3m0 0l.5 1.5m-.5-1.5h-9.5m0 0l-.5 1.5m.75-9l3-3 2.148 2.148A12.061 12.061 0 0116.5 7.605"/></svg>
      <span>Budgets</span>
    </div>
    <div class="nav-item" onclick="goto('goals', this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M16.5 18.75h-9m9 0a3 3 0 013 3h-15a3 3 0 013-3m9 0v-3.375c0-.621-.503-1.125-1.125-1.125h-.871M7.5 18.75v-3.375c0-.621.504-1.125 1.125-1.125h.872m5.007 0H9.497m5.007 0a7.454 7.454 0 01-.982-3.172M9.497 14.25a7.454 7.454 0 00.981-3.172M5.25 4.236c-.982.143-1.954.317-2.916.52A6.003 6.003 0 007.73 9.728M5.25 4.236V4.5c0 2.108.966 3.99 2.48 5.228M5.25 4.236V2.721C7.456 2.41 9.71 2.25 12 2.25c2.291 0 4.545.16 6.75.47v1.516M7.73 9.728a6.726 6.726 0 002.748 1.35m8.272-6.842V4.5c0 2.108-.966 3.99-2.48 5.228m2.48-5.492a46.32 46.32 0 012.916.52 6.003 6.003 0 01-5.395 4.972m0 0a6.726 6.726 0 01-2.749 1.35m0 0a6.772 6.772 0 01-3.044 0"/></svg>
      <span>Goals</span>
    </div>
    <div class="nav-section">Config</div>
    <div class="nav-item" onclick="goto('settings', this)">
      <svg fill="none" stroke="currentColor" stroke-width="1.5" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M9.594 3.94c.09-.542.56-.94 1.11-.94h2.593c.55 0 1.02.398 1.11.94l.213 1.281c.063.374.313.686.645.87.074.04.147.083.22.127.324.196.72.257 1.075.124l1.217-.456a1.125 1.125 0 011.37.49l1.296 2.247a1.125 1.125 0 01-.26 1.431l-1.003.827c-.293.24-.438.613-.431.992a6.759 6.759 0 010 .255c-.007.378.138.75.43.99l1.005.828c.424.35.534.954.26 1.43l-1.298 2.247a1.125 1.125 0 01-1.369.491l-1.217-.456c-.355-.133-.75-.072-1.076.124a6.57 6.57 0 01-.22.128c-.331.183-.581.495-.644.869l-.213 1.28c-.09.543-.56.941-1.11.941h-2.594c-.55 0-1.02-.398-1.11-.94l-.213-1.281c-.062-.374-.312-.686-.644-.87a6.52 6.52 0 01-.22-.127c-.325-.196-.72-.257-1.076-.124l-1.217.456a1.125 1.125 0 01-1.369-.49l-1.297-2.247a1.125 1.125 0 01.26-1.431l1.004-.827c.292-.24.437-.613.43-.992a6.932 6.932 0 010-.255c.007-.378-.138-.75-.43-.99l-1.004-.828a1.125 1.125 0 01-.26-1.43l1.297-2.247a1.125 1.125 0 011.37-.491l1.216.456c.356.133.751.072 1.076-.124.072-.044.146-.087.22-.128.332-.183.582-.495.644-.869l.214-1.281z"/><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
      <span>Settings</span>
    </div>
  </nav>
  <div class="month-nav">
    <div class="month-label">Period</div>
    <div class="month-display">
      <button class="month-btn" onclick="changeMonth(-1)">â€¹</button>
      <span id="monthLabel"></span>
      <button class="month-btn" onclick="changeMonth(1)">â€º</button>
    </div>
  </div>
</aside>

<!-- MAIN -->

<main>

<!-- DASHBOARD -->

<div class="page active" id="page-dashboard">
  <div class="page-header">
    <div class="page-title" id="dashTitle">Overview</div>
    <div class="page-sub" id="dashSub"></div>
  </div>
  <div class="cards-row">
    <div class="card green">
      <div class="card-label">Income</div>
      <div class="card-value" id="c-income">â‚¬0</div>
      <div class="card-sub" id="c-income-sub">This month</div>
    </div>
    <div class="card red">
      <div class="card-label">Expenses</div>
      <div class="card-value" id="c-expenses">â‚¬0</div>
      <div class="card-sub" id="c-expenses-sub">This month</div>
    </div>
    <div class="card purple">
      <div class="card-label">Balance</div>
      <div class="card-value" id="c-balance">â‚¬0</div>
      <div class="card-sub">Income âˆ’ Expenses</div>
    </div>
    <div class="card warn">
      <div class="card-label">Savings Rate</div>
      <div class="card-value" id="c-savings">0%</div>
      <div class="card-sub">Of income saved</div>
    </div>
    <div class="card">
      <div class="card-label">Safe To Spend</div>
      <div class="card-value" id="c-safe">â‚¬0</div>
      <div class="card-sub" id="c-safe-sub">After plan commitments</div>
    </div>
  </div>

  <div class="grid-wide">
    <div class="section">
      <div class="section-header">
        <span class="section-title">Monthly Overview</span>
        <div class="bar-legend">
          <div class="bar-legend-item"><div class="dot" style="background:var(--accent)"></div>Income</div>
          <div class="bar-legend-item"><div class="dot" style="background:var(--danger)"></div>Expenses</div>
        </div>
      </div>
      <div class="bar-chart" id="barChart"></div>
      <div style="display:flex;gap:4px" id="barLabels"></div>
    </div>

<div class="section">
  <div class="section-header">
    <span class="section-title">Spending</span>
    <span class="section-meta" id="donutMeta">By category</span>
  </div>
  <div style="display:flex;align-items:center;gap:20px;flex-wrap:wrap">
    <div class="donut-wrap">
      <svg width="120" height="120" viewBox="0 0 120 120">
        <circle cx="60" cy="60" r="44" fill="none" stroke="var(--border)" stroke-width="12"/>
        <circle id="donutCircle" cx="60" cy="60" r="44" fill="none" stroke="var(--accent)" stroke-width="12"
          stroke-dasharray="276.46" stroke-dashoffset="276.46" stroke-linecap="round"/>
      </svg>
      <div class="donut-center">
        <div class="donut-pct" id="donutPct">0%</div>
        <div class="donut-sub">budget used</div>
      </div>
    </div>
    <div id="donutLegend" style="flex:1;min-width:0"></div>
  </div>
</div>

  </div>

  <div class="section">
    <div class="section-header">
      <span class="section-title">Recent Transactions</span>
      <button class="add-btn" onclick="openAddTx()">+ Add</button>
    </div>
    <div class="tx-list" id="recentTxList"></div>
  </div>

  <div class="section" style="margin-top:16px">
    <div class="section-header">
      <span class="section-title">Smart Insights</span>
      <span class="section-meta">Auto-detected every month</span>
    </div>
    <div id="insightList" class="insight-list"></div>
  </div>
</div>

<!-- TRANSACTIONS -->

<div class="page" id="page-transactions">
  <div class="page-header" style="display:flex;align-items:flex-start;justify-content:space-between">
    <div>
      <div class="page-title">Transactions</div>
      <div class="page-sub">All your income & expenses</div>
    </div>
    <button class="add-btn" onclick="openAddTx()" style="margin-top:6px">+ New Transaction</button>
  </div>

  <div class="tx-filters">
    <button class="filter-btn active" onclick="setTxFilter('all',this)">All</button>
    <button class="filter-btn" onclick="setTxFilter('income',this)">Income</button>
    <button class="filter-btn" onclick="setTxFilter('expense',this)">Expenses</button>
  </div>

  <div class="section">
    <div class="tx-list" id="txList"></div>
  </div>
</div>

<!-- BUDGETS -->

<div class="page" id="page-budgets">
  <div class="page-header" style="display:flex;align-items:flex-start;justify-content:space-between">
    <div>
      <div class="page-title">Budgets</div>
      <div class="page-sub">Plan first, track all month</div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap">
      <button class="btn btn-ghost" onclick="suggestBudgets()">Auto-Suggest</button>
      <button class="add-btn" onclick="openAddBudget()">+ Add Budget</button>
    </div>
  </div>

  <div class="section" style="margin-bottom:14px">
    <div class="section-header">
      <span class="section-title">Monthly Plan</span>
      <button class="btn btn-ghost" onclick="copyLastMonthPlan()">Copy Last Month</button>
    </div>
    <div class="planner-grid">
      <div class="form-group"><label>Planned Income</label><input type="number" id="planIncome" min="0" step="0.01"></div>
      <div class="form-group"><label>Fixed Costs</label><input type="number" id="planFixed" min="0" step="0.01"></div>
      <div class="form-group"><label>Savings Target</label><input type="number" id="planSavings" min="0" step="0.01"></div>
      <div class="form-group"><label>Buffer</label><input type="number" id="planBuffer" min="0" step="0.01"></div>
    </div>
    <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px">
      <button class="btn btn-primary" onclick="saveMonthlyPlan()">Save Plan</button>
      <span class="section-meta" style="align-self:center">Used for safe-to-spend + daily allowance.</span>
    </div>
    <div class="insight-item" id="planStatus" style="margin-bottom:10px">Set your monthly plan to start forecasting.</div>
    <div class="kpi-row">
      <div class="kpi-chip"><div class="kpi-label">Planned Free Cash</div><div id="kpiPlanFree" class="kpi-value">â‚¬0</div></div>
      <div class="kpi-chip"><div class="kpi-label">Safe To Spend</div><div id="kpiSafeSpend" class="kpi-value">â‚¬0</div></div>
      <div class="kpi-chip"><div class="kpi-label">Daily Allowance</div><div id="kpiDaily" class="kpi-value">â‚¬0</div></div>
    </div>
  </div>

  <div id="budgetList"></div>
</div>

<!-- GOALS -->

<div class="page" id="page-goals">
  <div class="page-header" style="display:flex;align-items:flex-start;justify-content:space-between">
    <div>
      <div class="page-title">Savings Goals</div>
      <div class="page-sub">Track your targets</div>
    </div>
    <button class="add-btn" onclick="openAddGoal()">+ Add Goal</button>
  </div>
  <div id="goalList"></div>
</div>

<!-- SETTINGS -->

<div class="page" id="page-settings">
  <div class="page-header">
    <div class="page-title">Settings</div>
    <div class="page-sub">Preferences & data</div>
  </div>
  <div class="settings-section">
    <div class="settings-title">Profile</div>
    <div class="section" style="max-width:400px">
      <div class="form-grid">
        <div class="form-group full">
          <label>Your Name</label>
          <input type="text" id="settingName" placeholder="e.g. Prince" oninput="saveSetting('name',this.value)">
        </div>
        <div class="form-group">
          <label>Currency Symbol</label>
          <input type="text" id="settingCurrency" placeholder="â‚¬" maxlength="3" oninput="saveSetting('currency',this.value)">
        </div>
      </div>
    </div>
  </div>
  <div class="settings-section">
    <div class="settings-title">Data</div>
    <div style="display:flex;gap:10px;flex-wrap:wrap">
      <button class="btn btn-ghost" onclick="exportData()">Export JSON</button>
      <button class="btn btn-ghost" onclick="importFileClick()">Import JSON</button>
      <input type="file" id="importFile" accept=".json" style="display:none" onchange="importData(event)">
      <button class="btn" style="background:var(--danger);color:#fff" onclick="clearData()">Clear All Data</button>
    </div>
  </div>
</div>

</main>
</div>

<!-- ADD TRANSACTION MODAL -->

<div class="modal-overlay" id="txModal">
  <div class="modal">
    <div class="modal-title">New Transaction</div>
    <div class="form-grid">
      <div class="form-group full">
        <label>Type</label>
        <div class="type-toggle">
          <button class="type-btn active income" onclick="setTxType('income',this)">Income</button>
          <button class="type-btn expense" onclick="setTxType('expense',this)">Expense</button>
        </div>
      </div>
      <div class="form-group">
        <label>Amount</label>
        <input type="number" id="txAmount" placeholder="0.00" min="0" step="0.01">
      </div>
      <div class="form-group">
        <label>Date</label>
        <input type="date" id="txDate">
      </div>
      <div class="form-group">
        <label>Category</label>
        <select id="txCat"></select>
      </div>
      <div class="form-group">
        <label>Description</label>
        <input type="text" id="txDesc" placeholder="e.g. Salary, Groceries...">
      </div>
      <div class="form-group full">
        <label>Note (optional)</label>
        <textarea id="txNote" placeholder="Additional details..."></textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeTxModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveTx()">Save Transaction</button>
    </div>
  </div>
</div>

<!-- ADD BUDGET MODAL -->

<div class="modal-overlay" id="budgetModal">
  <div class="modal">
    <div class="modal-title">New Budget</div>
    <div class="form-grid">
      <div class="form-group">
        <label>Category</label>
        <input type="text" id="budgetCat" placeholder="e.g. Groceries">
      </div>
      <div class="form-group">
        <label>Monthly Limit</label>
        <input type="number" id="budgetLimit" placeholder="0.00" min="0" step="0.01">
      </div>
      <div class="form-group">
        <label>Icon (emoji)</label>
        <input type="text" id="budgetIcon" placeholder="ðŸ›’" maxlength="2">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeBudgetModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveBudget()">Save Budget</button>
    </div>
  </div>
</div>

<!-- ADD GOAL MODAL -->

<div class="modal-overlay" id="goalModal">
  <div class="modal">
    <div class="modal-title">New Savings Goal</div>
    <div class="form-grid">
      <div class="form-group full">
        <label>Goal Name</label>
        <input type="text" id="goalName" placeholder="e.g. Emergency Fund">
      </div>
      <div class="form-group">
        <label>Target Amount</label>
        <input type="number" id="goalTarget" placeholder="0.00" min="0">
      </div>
      <div class="form-group">
        <label>Saved So Far</label>
        <input type="number" id="goalSaved" placeholder="0.00" min="0">
      </div>
      <div class="form-group">
        <label>Deadline (optional)</label>
        <input type="date" id="goalDeadline">
      </div>
      <div class="form-group">
        <label>Icon</label>
        <input type="text" id="goalIcon" placeholder="ðŸŽ¯" maxlength="2">
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeGoalModal()">Cancel</button>
      <button class="btn btn-primary" onclick="saveGoal()">Save Goal</button>
    </div>
  </div>
</div>

<script>
// â”€â”€â”€ STATE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let state = {
  transactions: [],
  budgets: [],
  goals: [],
  settings: { name: '', currency: 'â‚¬', monthlyPlans: {} },
  currentMonth: new Date().getMonth(),
  currentYear: new Date().getFullYear(),
  txFilter: 'all',
  txType: 'income',
  ui: { sidebarCollapsed: false }
};

const EXPENSE_CATS = ['Housing','Food','Transport','Health','Entertainment','Shopping','Utilities','Education','Other'];
const INCOME_CATS = ['Salary','Freelance','Investment','Gift','Other'];
const CAT_COLORS = ['#00e5a0','#7c6af7','#ff5566','#f5a623','#38bdf8','#f472b6','#a3e635','#fb923c','#c084fc'];

// â”€â”€â”€ PERSISTENCE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function load() {
  const s = localStorage.getItem('vault_state');
  if (s) { try { Object.assign(state, JSON.parse(s)); } catch(e){} }
  if(!state.settings.monthlyPlans) state.settings.monthlyPlans = {};
  if(!state.ui) state.ui = { sidebarCollapsed: false };
  document.getElementById('settingName').value = state.settings.name || '';
  applySidebarState();
  document.getElementById('settingCurrency').value = state.settings.currency || 'â‚¬';
}
function save() { localStorage.setItem('vault_state', JSON.stringify(state)); }
function saveSetting(k,v) { state.settings[k]=v; save(); renderAll(); }

// â”€â”€â”€ NAVIGATION â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function applySidebarState() {
  if (window.innerWidth <= 768) return;
  document.body.classList.toggle('sidebar-collapsed', !!state.ui.sidebarCollapsed);
  const btn = document.querySelector('.sidebar-toggle');
  if(btn) btn.textContent = state.ui.sidebarCollapsed ? 'â€º' : 'â€¹';
}
function toggleSidebar() {
  if (window.innerWidth <= 768) return;
  state.ui.sidebarCollapsed = !state.ui.sidebarCollapsed;
  applySidebarState();
  save();
}
function goto(page, el) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  document.getElementById('page-'+page).classList.add('active');
  if(el) el.classList.add('active');
  else {
    document.querySelectorAll('.nav-item').forEach(n => {
      if(n.getAttribute('onclick') && n.getAttribute('onclick').includes("'"+page+"'")) n.classList.add('active');
    });
  }
  renderAll();
}
window.addEventListener('resize', applySidebarState);

// â”€â”€â”€ MONTH â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const MONTHS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const MONTHS_FULL = ['January','February','March','April','May','June','July','August','September','October','November','December'];

function changeMonth(d) {
  state.currentMonth += d;
  if(state.currentMonth > 11) { state.currentMonth = 0; state.currentYear++; }
  if(state.currentMonth < 0) { state.currentMonth = 11; state.currentYear--; }
  renderAll();
}
function updateMonthLabel() {
  document.getElementById('monthLabel').textContent = MONTHS[state.currentMonth];
}
function getMonthTx() {
  return state.transactions.filter(t => {
    const d = new Date(t.date);
    return d.getMonth() === state.currentMonth && d.getFullYear() === state.currentYear;
  });
}

function getMonthKey(month=state.currentMonth, year=state.currentYear) {
  return `${year}-${String(month+1).padStart(2,'0')}`;
}
function getPlan(month=state.currentMonth, year=state.currentYear) {
  const key = getMonthKey(month, year);
  return state.settings.monthlyPlans[key] || { income:0, fixed:0, savings:0, buffer:0 };
}
function saveMonthlyPlan() {
  const key = getMonthKey();
  state.settings.monthlyPlans[key] = {
    income: parseFloat(document.getElementById('planIncome').value) || 0,
    fixed: parseFloat(document.getElementById('planFixed').value) || 0,
    savings: parseFloat(document.getElementById('planSavings').value) || 0,
    buffer: parseFloat(document.getElementById('planBuffer').value) || 0
  };
  save();
  renderAll();
}
function copyLastMonthPlan() {
  let m = state.currentMonth - 1;
  let y = state.currentYear;
  if(m < 0){ m = 11; y -= 1; }
  const prev = getPlan(m, y);
  document.getElementById('planIncome').value = prev.income || '';
  document.getElementById('planFixed').value = prev.fixed || '';
  document.getElementById('planSavings').value = prev.savings || '';
  document.getElementById('planBuffer').value = prev.buffer || '';
}
function renderPlanner() {
  const cur = state.settings.currency || 'â‚¬';
  const plan = getPlan();
  const tx = getMonthTx();
  const income = tx.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
  const expenses = tx.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
  const plannedFree = plan.income - plan.fixed - plan.savings - plan.buffer;
  const safeToSpend = plannedFree - Math.max(0, expenses - plan.fixed);
  const daysInMonth = new Date(state.currentYear, state.currentMonth+1, 0).getDate();
  const today = new Date();
  const isCurrent = today.getMonth()===state.currentMonth && today.getFullYear()===state.currentYear;
  const day = isCurrent ? today.getDate() : 1;
  const daysLeft = Math.max(daysInMonth - day + 1, 1);
  const daily = safeToSpend / daysLeft;
  const planStatus = document.getElementById('planStatus');

  if(document.getElementById('planIncome')) {
    document.getElementById('planIncome').value = plan.income || '';
    document.getElementById('planFixed').value = plan.fixed || '';
    document.getElementById('planSavings').value = plan.savings || '';
    document.getElementById('planBuffer').value = plan.buffer || '';

    const freeEl = document.getElementById('kpiPlanFree');
    const safeEl = document.getElementById('kpiSafeSpend');
    const dailyEl = document.getElementById('kpiDaily');
    freeEl.textContent = `${cur}${fmt(plannedFree)}`;
    safeEl.textContent = `${cur}${fmt(safeToSpend)}`;
    dailyEl.textContent = `${cur}${fmt(daily)}`;
    freeEl.className = `kpi-value ${plannedFree<0?'bad':'good'}`;
    safeEl.className = `kpi-value ${safeToSpend<0?'bad':safeToSpend<100?'warn':'good'}`;
    dailyEl.className = `kpi-value ${daily<0?'bad':daily<10?'warn':'good'}`;
    if(planStatus){
      const gap = income - plan.income;
      const msg = plan.income ? `Actual income is ${gap>=0?'above':'below'} plan by ${cur}${fmt(Math.abs(gap))}. Expenses so far: ${cur}${fmt(expenses)}.` : 'Add planned income to compare your month against target.';
      planStatus.textContent = msg;
      planStatus.className = `insight-item ${safeToSpend<0?'bad':daily<10?'warn':''}`;
    }
  }

  const safeCard = document.getElementById('c-safe');
  if(safeCard) {
    safeCard.textContent = `${cur}${fmt(safeToSpend)}`;
    safeCard.style.color = safeToSpend < 0 ? 'var(--danger)' : 'var(--accent)';
    document.getElementById('c-safe-sub').textContent = `~ ${cur}${fmt(daily)} per day left`;
  }
}
function renderInsights() {
  const el = document.getElementById('insightList');
  if(!el) return;
  const cur = state.settings.currency || 'â‚¬';
  const tx = getMonthTx();
  const plan = getPlan();
  const expenses = tx.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
  const insights = [];

  if(plan.income > 0) {
    const committed = plan.fixed + plan.savings + plan.buffer;
    const pct = Math.round((committed / plan.income) * 100);
    insights.push({
      level: committed > plan.income ? 'bad' : pct > 80 ? 'warn' : '',
      text: `You committed ${pct}% of planned income before variable spend.`
    });
  }

  state.budgets.forEach(b => {
    const spent = tx.filter(t=>t.type==='expense' && t.category===b.cat).reduce((sum,t)=>sum+t.amount,0);
    if(spent > b.limit) insights.push({ level:'bad', text:`${b.cat} is over budget by ${cur}${fmt(spent-b.limit)}.` });
    else if(spent > b.limit*0.85) insights.push({ level:'warn', text:`${b.cat} has ${cur}${fmt(b.limit-spent)} remaining this month.` });
  });

  const recurring = {};
  state.transactions.forEach(t => {
    if(t.type !== 'expense') return;
    const key = `${t.desc||t.category}|${t.category}|${Math.round(t.amount)}`;
    recurring[key] = (recurring[key] || 0) + 1;
  });
  const likelyRecurring = Object.entries(recurring).filter(([,count])=>count>=3).slice(0,2);
  likelyRecurring.forEach(([k])=>{
    const [name] = k.split('|');
    insights.push({ level:'warn', text:`Recurring expense spotted: ${name}. Check if it should stay.` });
  });

  if(expenses === 0) insights.push({ level:'', text:'No expenses logged for this month yet. Great moment to set a precise plan.' });
  if(!insights.length) insights.push({ level:'', text:'You are on track. Keep logging transactions for stronger forecasts.' });

  el.innerHTML = insights.slice(0,5).map(i => `<div class="insight-item ${i.level}">${esc(i.text)}</div>`).join('');
}

// â”€â”€â”€ RENDER ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll() {
  updateMonthLabel();
  renderDashboard();
  renderTransactions();
  renderBudgets();
  renderGoals();
  renderPlanner();
  renderInsights();
}

// â”€â”€â”€ DASHBOARD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderDashboard() {
  const cur = state.settings.currency || 'â‚¬';
  const tx = getMonthTx();
  const income = tx.filter(t=>t.type==='income').reduce((s,t)=>s+t.amount,0);
  const expenses = tx.filter(t=>t.type==='expense').reduce((s,t)=>s+t.amount,0);
  const balance = income - expenses;
  const savingsRate = income > 0 ? Math.round((balance/income)*100) : 0;

  document.getElementById('dashTitle').textContent = MONTHS_FULL[state.currentMonth]+' '+state.currentYear;
  document.getElementById('dashSub').textContent = state.settings.name ? 'Hello, '+state.settings.name+'.' : 'Your financial overview';
  document.getElementById('c-income').textContent = cur+fmt(income);
  document.getElementById('c-expenses').textContent = cur+fmt(expenses);
  document.getElementById('c-balance').textContent = cur+fmt(balance);
  document.getElementById('c-balance').style.color = balance >= 0 ? 'var(--accent)' : 'var(--danger)';
  document.getElementById('c-savings').textContent = savingsRate+'%';

  // Bar chart - last 6 months
  const bc = document.getElementById('barChart');
  const bl = document.getElementById('barLabels');
  bc.innerHTML = ''; bl.innerHTML = '';
  const months = [];
  for(let i=5;i>=0;i--) {
    let m = state.currentMonth - i, y = state.currentYear;
    if(m<0){m+=12;y--;}
    months.push({m,y});
  }
  const allVals = [];
  months.forEach(({m,y}) => {
    const t = state.transactions.filter(tx=>{const d=new Date(tx.date);return d.getMonth()===m&&d.getFullYear()===y;});
    allVals.push(t.filter(x=>x.type==='income').reduce((s,x)=>s+x.amount,0));
    allVals.push(t.filter(x=>x.type==='expense').reduce((s,x)=>s+x.amount,0));
  });
  const maxV = Math.max(...allVals, 1);
  months.forEach(({m,y}) => {
    const t = state.transactions.filter(tx=>{const d=new Date(tx.date);return d.getMonth()===m&&d.getFullYear()===y;});
    const inc = t.filter(x=>x.type==='income').reduce((s,x)=>s+x.amount,0);
    const exp = t.filter(x=>x.type==='expense').reduce((s,x)=>s+x.amount,0);
    const wrap = document.createElement('div');
    wrap.className = 'bar-wrap';
    wrap.innerHTML = `<div style="display:flex;gap:2px;align-items:flex-end;height:100%;width:100%">
      <div class="bar income" style="height:${(inc/maxV)*100}%;flex:1"></div>
      <div class="bar expense" style="height:${(exp/maxV)*100}%;flex:1"></div>
    </div>`;
    bc.appendChild(wrap);
    const lbl = document.createElement('div');
    lbl.style.cssText='flex:1;text-align:center;font-size:9px;color:var(--muted);margin-top:4px';
    lbl.textContent = MONTHS[m];
    bl.appendChild(lbl);
  });

  // Donut - budget usage
  const totalBudget = state.budgets.reduce((s,b)=>s+b.limit,0);
  const pct = totalBudget > 0 ? Math.min(expenses/totalBudget,1) : 0;
  const circ = 276.46;
  document.getElementById('donutCircle').style.strokeDashoffset = circ - pct*circ;
  document.getElementById('donutCircle').style.stroke = pct > 0.9 ? 'var(--danger)' : pct > 0.7 ? 'var(--warn)' : 'var(--accent)';
  document.getElementById('donutPct').textContent = Math.round(pct*100)+'%';
  document.getElementById('donutPct').style.color = pct > 0.9 ? 'var(--danger)' : pct > 0.7 ? 'var(--warn)' : 'var(--accent)';

  // Donut legend - top categories
  const catMap = {};
  tx.filter(t=>t.type==='expense').forEach(t=>{catMap[t.category]=(catMap[t.category]||0)+t.amount;});
  const cats = Object.entries(catMap).sort((a,b)=>b[1]-a[1]).slice(0,5);
  const legend = document.getElementById('donutLegend');
  legend.innerHTML = cats.map(([cat,amt],i)=>`
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
      <div style="display:flex;align-items:center;gap:7px">
        <div style="width:8px;height:8px;border-radius:2px;background:${CAT_COLORS[i%CAT_COLORS.length]};flex-shrink:0"></div>
        <span style="font-size:11px;color:var(--text)">${cat}</span>
      </div>
      <span style="font-size:11px;color:var(--muted)">${cur}${fmt(amt)}</span>
    </div>`).join('') || '<div style="font-size:11px;color:var(--muted)">No expenses yet</div>';

  // Recent tx
  const recent = [...tx].sort((a,b)=>new Date(b.date)-new Date(a.date)).slice(0,6);
  renderTxInto(document.getElementById('recentTxList'), recent, false);
}

// â”€â”€â”€ TRANSACTIONS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function setTxFilter(f, el) {
  state.txFilter = f;
  document.querySelectorAll('.filter-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  renderTransactions();
}
function renderTransactions() {
  let tx = getMonthTx();
  if(state.txFilter !== 'all') tx = tx.filter(t=>t.type===state.txFilter);
  tx.sort((a,b)=>new Date(b.date)-new Date(a.date));
  const el = document.getElementById('txList');
  if(!el) return;
  renderTxInto(el, tx, true);
}
function renderTxInto(el, txs, showDelete) {
  if(!txs.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ðŸ“­</div><div class="empty-text">No transactions yet</div></div>';
    return;
  }
  const cur = state.settings.currency || 'â‚¬';
  const icons = {Housing:'ðŸ ',Food:'ðŸ”',Transport:'ðŸš—',Health:'ðŸ’Š',Entertainment:'ðŸŽ®',Shopping:'ðŸ›ï¸',Utilities:'ðŸ’¡',Education:'ðŸ“š',Salary:'',Freelance:'ðŸ’»',Investment:'ðŸ“ˆ',Gift:'ðŸŽ',Other:'ðŸ“'};
  el.innerHTML = txs.map(t=>`
    <div class="tx-item">
      <div class="tx-icon" style="background:${t.type==='income'?'rgba(0,229,160,0.1)':'rgba(255,85,102,0.1)'}">
        ${icons[t.category]||'ðŸ’°'}
      </div>
      <div class="tx-info">
        <div class="tx-name">${esc(t.desc || t.category)}</div>
        <div class="tx-meta">${t.category} Â· ${fmtDate(t.date)}</div>
      </div>
      <div style="display:flex;align-items:center">
        <div class="tx-amount ${t.type}">${t.type==='income'?'+':'-'}${cur}${fmt(t.amount)}</div>
        ${showDelete?`<div class="tx-actions"><button class="tx-del" onclick="deleteTx('${t.id}')" title="Delete">âœ•</button></div>`:''}
      </div>
    </div>`).join('');
}

// â”€â”€â”€ TX MODAL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAddTx() {
  state.txType = 'income';
  document.querySelectorAll('.type-btn').forEach(b=>{
    b.classList.remove('active');
    if(b.classList.contains('income')) b.classList.add('active');
  });
  updateTxCats();
  document.getElementById('txDate').value = new Date().toISOString().split('T')[0];
  document.getElementById('txAmount').value = '';
  document.getElementById('txDesc').value = '';
  document.getElementById('txNote').value = '';
  document.getElementById('txModal').classList.add('open');
}
function closeTxModal() { document.getElementById('txModal').classList.remove('open'); }
function setTxType(type, el) {
  state.txType = type;
  document.querySelectorAll('.type-btn').forEach(b=>b.classList.remove('active'));
  el.classList.add('active');
  updateTxCats();
}
function updateTxCats() {
  const cats = state.txType === 'income' ? INCOME_CATS : EXPENSE_CATS;
  const sel = document.getElementById('txCat');
  sel.innerHTML = cats.map(c=>`<option value="${c}">${c}</option>`).join('');
}
function saveTx() {
  const amount = parseFloat(document.getElementById('txAmount').value);
  const date = document.getElementById('txDate').value;
  if(!amount || amount <= 0 || !date) { alert('Please enter a valid amount and date'); return; }
  state.transactions.push({
    id: Date.now().toString(),
    type: state.txType,
    amount,
    date,
    category: document.getElementById('txCat').value,
    desc: document.getElementById('txDesc').value,
    note: document.getElementById('txNote').value
  });
  save();
  closeTxModal();
  renderAll();
}
function deleteTx(id) {
  if(!confirm('Delete this transaction?')) return;
  state.transactions = state.transactions.filter(t=>t.id!==id);
  save(); renderAll();
}

// â”€â”€â”€ BUDGETS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function suggestBudgets() {
  const tx = state.transactions.filter(t=>t.type==='expense');
  if(!tx.length) { alert('Add some expense transactions first for suggestions.'); return; }
  const byCat = {};
  tx.forEach(t=>{ byCat[t.category]=(byCat[t.category]||0)+t.amount; });
  const top = Object.entries(byCat).sort((a,b)=>b[1]-a[1]).slice(0,4);
  top.forEach(([cat,total])=>{
    const exists = state.budgets.some(b=>b.cat===cat);
    if(exists) return;
    const suggested = Math.max(50, Math.round((total/Math.max(1, tx.length/4))*1.1));
    state.budgets.push({ id: Date.now().toString()+cat, cat, limit: suggested, icon: 'ðŸ“¦' });
  });
  save();
  renderBudgets();
  renderInsights();
}
function openAddBudget() {

  document.getElementById('budgetCat').value='';
  document.getElementById('budgetLimit').value='';
  document.getElementById('budgetIcon').value='';
  document.getElementById('budgetModal').classList.add('open');
}
function closeBudgetModal() { document.getElementById('budgetModal').classList.remove('open'); }
function saveBudget() {
  const cat = document.getElementById('budgetCat').value.trim();
  const limit = parseFloat(document.getElementById('budgetLimit').value);
  if(!cat || !limit || limit<=0) { alert('Please fill in all fields'); return; }
  state.budgets.push({ id:Date.now().toString(), cat, limit, icon: document.getElementById('budgetIcon').value || 'ðŸ“¦' });
  save(); closeBudgetModal(); renderBudgets();
}
function deleteBudget(id) {
  state.budgets = state.budgets.filter(b=>b.id!==id);
  save(); renderBudgets();
}
function renderBudgets() {
  const el = document.getElementById('budgetList');
  if(!el) return;
  const cur = state.settings.currency || 'â‚¬';
  const tx = getMonthTx().filter(t=>t.type==='expense');
  if(!state.budgets.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ðŸ“Š</div><div class="empty-text">No budgets yet â€” add one to track spending</div></div>';
    return;
  }
  el.innerHTML = state.budgets.map(b=>{
    const spent = tx.filter(t=>t.category===b.cat).reduce((s,t)=>s+t.amount,0);
    const pct = Math.min(spent/b.limit,1);
    const pctNum = Math.round(pct*100);
    const barColor = pct>0.9?'var(--danger)':pct>0.7?'var(--warn)':'var(--accent)';
    const badgeClass = pct>0.9?'over':pct>0.7?'warn':'ok';
    return `<div class="budget-card">
      <div class="budget-header-row">
        <div style="display:flex;align-items:center;gap:10px">
          <span style="font-size:22px">${b.icon}</span>
          <div>
            <div class="budget-cat-name">${esc(b.cat)}</div>
            <div style="font-size:10px;color:var(--muted)">${cur}${fmt(spent)} of ${cur}${fmt(b.limit)}</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="budget-pct-badge ${badgeClass}">${pctNum}%</span>
          <button class="tx-del" onclick="deleteBudget('${b.id}')">âœ•</button>
        </div>
      </div>
      <div class="budget-bar-track">
        <div class="budget-bar-fill" style="width:${pct*100}%;background:${barColor}"></div>
      </div>
      <div style="display:flex;justify-content:space-between;margin-top:6px;font-size:10px;color:var(--muted)">
        <span>${pct>=1?'Over budget!':'Remaining: '+cur+fmt(b.limit-spent)}</span>
        <span>Limit: ${cur}${fmt(b.limit)}/mo</span>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€â”€ GOALS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function openAddGoal() {
  ['goalName','goalTarget','goalSaved','goalDeadline','goalIcon'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('goalModal').classList.add('open');
}
function closeGoalModal() { document.getElementById('goalModal').classList.remove('open'); }
function saveGoal() {
  const name = document.getElementById('goalName').value.trim();
  const target = parseFloat(document.getElementById('goalTarget').value);
  if(!name || !target || target<=0) { alert('Please fill in name and target'); return; }
  state.goals.push({
    id:Date.now().toString(),
    name, target,
    saved: parseFloat(document.getElementById('goalSaved').value)||0,
    deadline: document.getElementById('goalDeadline').value,
    icon: document.getElementById('goalIcon').value || 'ðŸŽ¯'
  });
  save(); closeGoalModal(); renderGoals();
}
function updateGoalSaved(id, val) {
  const g = state.goals.find(x=>x.id===id);
  if(g) { g.saved=Math.max(0,parseFloat(val)||0); save(); renderGoals(); }
}
function deleteGoal(id) {
  state.goals = state.goals.filter(g=>g.id!==id);
  save(); renderGoals();
}
function renderGoals() {
  const el = document.getElementById('goalList');
  if(!el) return;
  const cur = state.settings.currency || 'â‚¬';
  if(!state.goals.length) {
    el.innerHTML = '<div class="empty"><div class="empty-icon">ðŸŽ¯</div><div class="empty-text">No goals yet â€” set your first savings target</div></div>';
    return;
  }
  el.innerHTML = state.goals.map(g=>{
    const pct = Math.min(g.saved/g.target,1);
    const daysLeft = g.deadline ? Math.ceil((new Date(g.deadline)-new Date())/(1000*60*60*24)) : null;
    return `<div class="budget-card">
      <div class="budget-header-row">
        <div style="display:flex;align-items:center;gap:10px">
          <span style="font-size:26px">${g.icon}</span>
          <div>
            <div class="budget-cat-name">${esc(g.name)}</div>
            <div style="font-size:10px;color:var(--muted)">${cur}${fmt(g.saved)} saved of ${cur}${fmt(g.target)}</div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:8px">
          <span class="budget-pct-badge ok">${Math.round(pct*100)}%</span>
          <button class="tx-del" onclick="deleteGoal('${g.id}')">âœ•</button>
        </div>
      </div>
      <div class="goal-bar-track">
        <div class="goal-bar-fill" style="width:${pct*100}%"></div>
      </div>
      <div style="display:flex;justify-content:space-between;align-items:center;margin-top:10px">
        <div style="font-size:10px;color:var(--muted)">${daysLeft!==null?(daysLeft>0?daysLeft+' days left':'Deadline passed'):'No deadline'}</div>
        <div style="display:flex;align-items:center;gap:6px">
          <span style="font-size:10px;color:var(--muted)">Update saved:</span>
          <input type="number" value="${g.saved}" min="0" step="10"
            style="width:90px;padding:4px 8px;font-size:11px"
            onchange="updateGoalSaved('${g.id}',this.value)">
        </div>
      </div>
    </div>`;
  }).join('');
}

// â”€â”€â”€ SETTINGS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function exportData() {
  const blob = new Blob([JSON.stringify(state, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = 'vault-backup.json';
  a.click();
}
function importFileClick() { document.getElementById('importFile').click(); }
function importData(e) {
  const file = e.target.files[0];
  if(!file) return;
  const reader = new FileReader();
  reader.onload = ev => {
    try {
      const data = JSON.parse(ev.target.result);
      Object.assign(state, data);
      save();
      document.getElementById('settingName').value = state.settings.name || '';
      document.getElementById('settingCurrency').value = state.settings.currency || 'â‚¬';
      renderAll();
      alert('Data imported!');
    } catch(e) { alert('Invalid file'); }
  };
  reader.readAsText(file);
}
function clearData() {
  if(!confirm('Clear ALL data? This cannot be undone.')) return;
  state.transactions = []; state.budgets = []; state.goals = [];
  save(); renderAll();
}

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function fmt(n) { return Number(n).toLocaleString('en',{minimumFractionDigits:2,maximumFractionDigits:2}); }
function esc(s) { return String(s).replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;'); }
function fmtDate(d) {
  const dt = new Date(d);
  return dt.toLocaleDateString('en',{day:'numeric',month:'short'});
}

// â”€â”€â”€ CLOSE MODALS ON OVERLAY CLICK â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
document.querySelectorAll('.modal-overlay').forEach(o=>{
  o.addEventListener('click', e=>{ if(e.target===o) o.classList.remove('open'); });
});

// â”€â”€â”€ INIT â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
load();
renderAll();
</script>

</body>
</html>
